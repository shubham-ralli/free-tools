<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Universal Data Format Converter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 0; min-height: 100vh; }
    .main-card { background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    pre.code-box {
      background: #1e1e1e;
      color: #00ff9d;
      padding: 15px;
      border-radius: 10px;
      overflow-y: auto;
      max-height: 500px;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .loader {
      display: none;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .table-responsive {
      max-height: 400px;
      overflow: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; font-size: 14px; }
    th { background-color: #667eea; color: white; position: sticky; top: 0; z-index: 10; }
    .format-selector { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
    .format-btn { 
      padding: 8px 16px; 
      border: 2px solid #667eea; 
      background: white; 
      color: #667eea; 
      border-radius: 20px; 
      cursor: pointer; 
      transition: all 0.3s;
      font-size: 13px;
      font-weight: 600;
    }
    .format-btn:hover { background: #667eea; color: white; }
    .format-btn.active { background: #667eea; color: white; }
    .section-title { color: #667eea; font-weight: bold; margin: 20px 0 10px 0; }
    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8f9ff;
    }
    .upload-area:hover { background: #e8e9ff; border-color: #764ba2; }
    .upload-area.drag-over { background: #d0d1ff; border-color: #764ba2; }
  </style>
</head>
<body>
<div class="container">
  <h2 class="text-center mb-4 text-white">üîÑ Universal Data Format Converter</h2>
  <div class="main-card p-4">
    
    <!-- Upload Section -->
    <div class="section-title">üì§ Step 1: Upload Your Data</div>
  
      <input type="file" id="fileInput" accept=".xls,.xlsx,.csv,.json,.xml,.html,.sql">
   
    
    <textarea id="textInput" class="form-control mt-3" rows="5" placeholder="Or paste your data here (JSON, XML, SQL, HTML table, CSV, MySQL result)..."></textarea>
    <button id="parseText" class="btn btn-primary mt-2">Parse Pasted Data</button>

    <!-- Sheet Selection -->
    <select id="sheetSelect" class="form-select mt-3" style="display:none;"></select>
    
    <div class="loader" id="loader"></div>

    <!-- Preview Section -->
    <div id="previewSection" style="display:none;">
      <div class="section-title mt-4">üëÄ Step 2: Preview Your Data</div>
      <div id="output" class="table-responsive"></div>
      <div class="text-muted small mt-2">Showing <span id="rowCount">0</span> rows</div>
    </div>

    <!-- Output Format Selection -->
    <div id="formatSection" style="display:none;">
      <div class="section-title mt-4">üéØ Step 3: Choose Output Format</div>
      <div class="format-selector" id="formatButtons"></div>
    </div>

    <!-- Output Display -->
    <div id="outputContainer" style="display:none;">
      <div class="section-title mt-4">‚ú® Generated Output</div>
      <pre id="codeOutput" class="code-box"></pre>
      <div class="btn-group mt-3">
        <button id="copyBtn" class="btn btn-success">üìã Copy to Clipboard</button>
        <button id="downloadBtn" class="btn btn-primary">üíæ Download File</button>
        <button id="clearBtn" class="btn btn-danger">üóëÔ∏è Clear All</button>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  let parsedData = [];
  let currentFormat = 'json';
  let workbookData = null;

  const formats = [
    'JSON', 'Excel', 'SQL Insert', 'HTML Table', 'CSV', 'Markdown', 
    'XML', 'ASCII', 'MediaWiki', 'YAML', 'PHP Array', 'BBCode', 
    'Ruby', 'reStructuredText', 'ASP', 'ActionScript', 'TOML', 
    'INI', 'Firebase', 'Qlik', 'JSONLines'
  ];

  // Initialize format buttons
  formats.forEach(fmt => {
    const btn = $(`<button class="format-btn" data-format="${fmt.toLowerCase().replace(/\s+/g, '_')}">${fmt}</button>`);
    $('#formatButtons').append(btn);
  });

  $('#formatButtons').on('click', '.format-btn', function() {
    $('.format-btn').removeClass('active');
    $(this).addClass('active');
    currentFormat = $(this).data('format');
    generateOutput(currentFormat);
  });

  // Drag and drop
  // $('#uploadArea').on('click', () => $('#fileInput').click());
  
  // $('#uploadArea').on('dragover', function(e) {
  //   e.preventDefault();
  //   $(this).addClass('drag-over');
  // });
  
  // $('#uploadArea').on('dragleave', function() {
  //   $(this).removeClass('drag-over');
  // });
  
  // $('#uploadArea').on('drop', function(e) {
  //   e.preventDefault();
  //   $(this).removeClass('drag-over');
  //   const file = e.originalEvent.dataTransfer.files[0];
  //   if (file) handleFile(file);
  // });

  $('#fileInput').on('change', function(e) {
    const file = e.target.files[0];
    if (file) handleFile(file);
  });

  $('#parseText').on('click', function() {
    const text = $('#textInput').val().trim();
    if (text) parseTextData(text);
  });

  function handleFile(file) {
    $('#loader').show();
    const ext = file.name.split('.').pop().toLowerCase();
    const reader = new FileReader();

    reader.onload = function(e) {
      const content = e.target.result;
      
      if (['xls', 'xlsx'].includes(ext)) {
        parseExcel(content);
      } else if (ext === 'csv') {
        parseCSV(content);
      } else if (ext === 'json') {
        parseJSON(content);
      } else if (ext === 'xml') {
        parseXML(content);
      } else if (ext === 'html') {
        parseHTML(content);
      } else if (ext === 'sql') {
        parseSQL(content);
      }
    };

    if (['xls', 'xlsx'].includes(ext)) {
      reader.readAsArrayBuffer(file);
    } else {
      reader.readAsText(file);
    }
  }

  function parseExcel(data) {
    const uint8Array = new Uint8Array(data);
    workbookData = XLSX.read(uint8Array, { type: 'array' });
    const sheetNames = workbookData.SheetNames;
    
    $('#sheetSelect').empty();
    sheetNames.forEach((name, i) => {
      $('#sheetSelect').append(`<option value="${i}">${name}</option>`);
    });
    
    if (sheetNames.length > 1) $('#sheetSelect').show();
    
    const firstSheet = workbookData.Sheets[sheetNames[0]];
    parsedData = XLSX.utils.sheet_to_json(firstSheet, { defval: '' });
    displayData();
  }

  $('#sheetSelect').on('change', function() {
    const index = $(this).val();
    if (workbookData) {
      const sheet = workbookData.Sheets[workbookData.SheetNames[index]];
      parsedData = XLSX.utils.sheet_to_json(sheet, { defval: '' });
      displayData();
    }
  });

  function parseCSV(content) {
    const lines = content.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
    parsedData = [];
    
    for (let i = 1; i < lines.length; i++) {
      const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
      const obj = {};
      headers.forEach((h, idx) => obj[h] = values[idx] || '');
      parsedData.push(obj);
    }
    displayData();
  }

  function parseJSON(content) {
    try {
      const data = JSON.parse(content);
      parsedData = Array.isArray(data) ? data : [data];
      displayData();
    } catch (e) {
      alert('Invalid JSON format');
      $('#loader').hide();
    }
  }

  function parseXML(content) {
    try {
      const parser = new DOMParser();
      const xml = parser.parseFromString(content, 'text/xml');
      const rows = xml.getElementsByTagName('row');
      parsedData = [];
      
      for (let row of rows) {
        const obj = {};
        for (let child of row.children) {
          obj[child.tagName] = child.textContent;
        }
        parsedData.push(obj);
      }
      displayData();
    } catch (e) {
      alert('Invalid XML format');
      $('#loader').hide();
    }
  }

  function parseHTML(content) {
    const tempDiv = $('<div>').html(content);
    const table = tempDiv.find('table').first();
    const headers = [];
    
    table.find('thead tr th, tr:first td').each(function() {
      headers.push($(this).text().trim());
    });
    
    parsedData = [];
    table.find('tbody tr, tr').slice(1).each(function() {
      const obj = {};
      $(this).find('td').each(function(idx) {
        obj[headers[idx]] = $(this).text().trim();
      });
      if (Object.keys(obj).length > 0) parsedData.push(obj);
    });
    displayData();
  }

  function parseSQL(content) {
    const regex = /INSERT\s+INTO\s+\w+\s*\((.*?)\)\s*VALUES\s*\((.*?)\)/gi;
    const matches = [...content.matchAll(regex)];
    
    if (matches.length > 0) {
      const headers = matches[0][1].split(',').map(h => h.trim().replace(/[`'"]/g, ''));
      parsedData = [];
      
      matches.forEach(match => {
        const values = match[2].split(',').map(v => v.trim().replace(/^['"]|['"]$/g, ''));
        const obj = {};
        headers.forEach((h, idx) => obj[h] = values[idx] || '');
        parsedData.push(obj);
      });
      displayData();
    } else {
      alert('No valid SQL INSERT statements found');
      $('#loader').hide();
    }
  }

  function parseTextData(text) {
    $('#loader').show();
    
    // Try to detect format
    if (text.startsWith('{') || text.startsWith('[')) {
      parseJSON(text);
    } else if (text.includes('INSERT INTO')) {
      parseSQL(text);
    } else if (text.includes('<table')) {
      parseHTML(text);
    } else if (text.includes('<?xml') || text.includes('<row>')) {
      parseXML(text);
    } else {
      parseCSV(text);
    }
  }

  function displayData() {
    $('#loader').hide();
    
    if (!parsedData || parsedData.length === 0) {
      alert('No data found');
      return;
    }

    const headers = Object.keys(parsedData[0]);
    let table = '<table class="table table-striped"><thead><tr>';
    headers.forEach(h => table += `<th>${h}</th>`);
    table += '</tr></thead><tbody>';

    parsedData.forEach(row => {
      table += '<tr>';
      headers.forEach(h => table += `<td>${row[h] ?? ''}</td>`);
      table += '</tr>';
    });
    table += '</tbody></table>';

    $('#output').html(table);
    $('#rowCount').text(parsedData.length);
    $('#previewSection').show();
    $('#formatSection').show();
    
    // Auto-select JSON format
    $('.format-btn[data-format="json"]').click();
  }

  function normalizeKey(key) {
    return key.trim().toLowerCase().replace(/\s+/g, '_');
  }

  function escapeString(str) {
    return String(str).replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/"/g, '\\"');
  }

  function generateOutput(format) {
    let output = '';
    const normalizedData = parsedData.map(row => {
      const obj = {};
      for (let key in row) {
        obj[normalizeKey(key)] = row[key];
      }
      return obj;
    });

    switch(format) {
      case 'json':
        output = JSON.stringify(parsedData, null, 2);
        break;
      
      case 'sql_insert':
        const tableName = 'table_name';
        const keys = Object.keys(normalizedData[0]);
        normalizedData.forEach(row => {
          const values = keys.map(k => {
            const val = row[k];
            return typeof val === 'number' ? val : `'${escapeString(val)}'`;
          });
          output += `INSERT INTO ${tableName} (${keys.join(', ')}) VALUES (${values.join(', ')});\n`;
        });
        break;
      
      case 'html_table':
        output = '<table border="1">\n  <thead>\n    <tr>\n';
        Object.keys(parsedData[0]).forEach(h => output += `      <th>${h}</th>\n`);
        output += '    </tr>\n  </thead>\n  <tbody>\n';
        parsedData.forEach(row => {
          output += '    <tr>\n';
          Object.values(row).forEach(v => output += `      <td>${v}</td>\n`);
          output += '    </tr>\n';
        });
        output += '  </tbody>\n</table>';
        break;
      
      case 'csv':
        const csvHeaders = Object.keys(parsedData[0]);
        output = csvHeaders.join(',') + '\n';
        parsedData.forEach(row => {
          output += csvHeaders.map(h => `"${row[h]}"`).join(',') + '\n';
        });
        break;
      
      case 'markdown':
        const mdKeys = Object.keys(parsedData[0]);
        output = '| ' + mdKeys.join(' | ') + ' |\n';
        output += '| ' + mdKeys.map(() => '---').join(' | ') + ' |\n';
        parsedData.forEach(row => {
          output += '| ' + mdKeys.map(k => row[k]).join(' | ') + ' |\n';
        });
        break;
      
      case 'xml':
        output = '<?xml version="1.0" encoding="UTF-8"?>\n<data>\n';
        parsedData.forEach(row => {
          output += '  <row>\n';
          Object.entries(row).forEach(([k, v]) => {
            output += `    <${normalizeKey(k)}>${v}</${normalizeKey(k)}>\n`;
          });
          output += '  </row>\n';
        });
        output += '</data>';
        break;
      
      case 'php_array':
        output = "<?php\n$data = array(\n";
        normalizedData.forEach(row => {
          output += "  array(\n";
          Object.entries(row).forEach(([k, v]) => {
            const val = typeof v === 'number' ? v : `'${escapeString(v)}'`;
            output += `    '${k}' => ${val},\n`;
          });
          output += "  ),\n";
        });
        output += ");\n?>";
        break;
      
      case 'yaml':
        output = parsedData.map(row => {
          let yaml = '-\n';
          Object.entries(row).forEach(([k, v]) => {
            yaml += `  ${normalizeKey(k)}: ${JSON.stringify(v)}\n`;
          });
          return yaml;
        }).join('');
        break;
      
      case 'ascii':
        const asciiKeys = Object.keys(parsedData[0]);
        const colWidths = asciiKeys.map(k => Math.max(k.length, ...parsedData.map(r => String(r[k]).length)) + 2);
        const line = '+' + colWidths.map(w => '-'.repeat(w)).join('+') + '+\n';
        output = line;
        output += '|' + asciiKeys.map((k, i) => k.padEnd(colWidths[i])).join('|') + '|\n';
        output += line;
        parsedData.forEach(row => {
          output += '|' + asciiKeys.map((k, i) => String(row[k]).padEnd(colWidths[i])).join('|') + '|\n';
        });
        output += line;
        break;
      
      case 'mediawiki':
        output = '{| class="wikitable"\n|-\n';
        Object.keys(parsedData[0]).forEach(h => output += `! ${h}\n`);
        parsedData.forEach(row => {
          output += '|-\n';
          Object.values(row).forEach(v => output += `| ${v}\n`);
        });
        output += '|}';
        break;
      
      case 'bbcode':
        output = '[table]\n[tr]';
        Object.keys(parsedData[0]).forEach(h => output += `[th]${h}[/th]`);
        output += '[/tr]\n';
        parsedData.forEach(row => {
          output += '[tr]';
          Object.values(row).forEach(v => output += `[td]${v}[/td]`);
          output += '[/tr]\n';
        });
        output += '[/table]';
        break;
      
      case 'ruby':
        output = "data = [\n";
        normalizedData.forEach(row => {
          output += "  {\n";
          Object.entries(row).forEach(([k, v]) => {
            const val = typeof v === 'number' ? v : `'${escapeString(v)}'`;
            output += `    '${k}' => ${val},\n`;
          });
          output += "  },\n";
        });
        output += "]";
        break;
      
      case 'restructuredtext':
        const rstKeys = Object.keys(parsedData[0]);
        const rstWidths = rstKeys.map(k => Math.max(k.length, ...parsedData.map(r => String(r[k]).length)));
        const rstLine = rstWidths.map(w => '='.repeat(w)).join(' ') + '\n';
        output = rstLine;
        output += rstKeys.map((k, i) => k.padEnd(rstWidths[i])).join(' ') + '\n';
        output += rstLine;
        parsedData.forEach(row => {
          output += rstKeys.map((k, i) => String(row[k]).padEnd(rstWidths[i])).join(' ') + '\n';
        });
        output += rstLine;
        break;
      
      case 'asp':
        output = "<%\nDim data\ndata = Array( _\n";
        normalizedData.forEach((row, idx) => {
          output += "  Array(";
          output += Object.values(row).map(v => 
            typeof v === 'number' ? v : `"${escapeString(v)}"`
          ).join(', ');
          output += ')' + (idx < normalizedData.length - 1 ? ', _\n' : '\n');
        });
        output += ")\n%>";
        break;
      
      case 'actionscript':
        output = "var data:Array = [\n";
        normalizedData.forEach(row => {
          output += "  {\n";
          Object.entries(row).forEach(([k, v]) => {
            const val = typeof v === 'number' ? v : `"${escapeString(v)}"`;
            output += `    ${k}: ${val},\n`;
          });
          output += "  },\n";
        });
        output += "];";
        break;
      
      case 'toml':
        parsedData.forEach((row, idx) => {
          output += `[[data]]\n`;
          Object.entries(row).forEach(([k, v]) => {
            const val = typeof v === 'number' ? v : `"${escapeString(v)}"`;
            output += `${normalizeKey(k)} = ${val}\n`;
          });
          output += '\n';
        });
        break;
      
      case 'ini':
        parsedData.forEach((row, idx) => {
          output += `[row_${idx}]\n`;
          Object.entries(row).forEach(([k, v]) => {
            output += `${normalizeKey(k)}=${v}\n`;
          });
          output += '\n';
        });
        break;
      
      case 'firebase':
        const firebaseData = {};
        parsedData.forEach((row, idx) => {
          firebaseData[`item_${idx}`] = row;
        });
        output = JSON.stringify(firebaseData, null, 2);
        break;
      
      case 'qlik':
        output = "LOAD * INLINE [\n";
        const qlikKeys = Object.keys(parsedData[0]);
        output += qlikKeys.join(', ') + '\n';
        parsedData.forEach(row => {
          output += qlikKeys.map(k => row[k]).join(', ') + '\n';
        });
        output += "];";
        break;
      
      case 'jsonlines':
        output = parsedData.map(row => JSON.stringify(row)).join('\n');
        break;
      
      case 'excel':
        output = 'Excel export requires download - click the Download button';
        break;
    }

    $('#codeOutput').text(output);
    $('#outputContainer').show();
  }

  $('#copyBtn').on('click', function() {
    navigator.clipboard.writeText($('#codeOutput').text()).then(() => {
      const btn = $(this);
      const originalText = btn.text();
      btn.text('‚úÖ Copied!');
      setTimeout(() => btn.text(originalText), 2000);
    });
  });

  $('#downloadBtn').on('click', function() {
    const extensions = {
      json: 'json', sql_insert: 'sql', html_table: 'html', csv: 'csv',
      markdown: 'md', xml: 'xml', php_array: 'php', yaml: 'yaml',
      ascii: 'txt', mediawiki: 'txt', bbcode: 'txt', ruby: 'rb',
      restructuredtext: 'rst', asp: 'asp', actionscript: 'as',
      toml: 'toml', ini: 'ini', firebase: 'json', qlik: 'qvs',
      jsonlines: 'jsonl'
    };

    if (currentFormat === 'excel') {
      const ws = XLSX.utils.json_to_sheet(parsedData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Data');
      XLSX.writeFile(wb, 'data.xlsx');
    } else {
      const content = $('#codeOutput').text();
      const blob = new Blob([content], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `data.${extensions[currentFormat] || 'txt'}`;
      link.click();
    }
  });

  $('#clearBtn').on('click', function() {
    parsedData = [];
    workbookData = null;
    $('#output').empty();
    $('#codeOutput').empty();
    $('#previewSection').hide();
    $('#formatSection').hide();
    $('#outputContainer').hide();
    $('#sheetSelect').hide();
    $('#textInput').val('');
    $('#fileInput').val('');
    $('.format-btn').removeClass('active');
  });
});
</script>
</body>
</html>
