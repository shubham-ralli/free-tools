<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CSV Generator Tool</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<style>
    .field-row { cursor: move; }
    .minmax { display: none; }
</style>
</head>
<body class="p-3">

<div class="container">
    <h3 class="mb-3">CSV Generator Tool</h3>

    <!-- Row count -->
    <div class="mb-3">
        <label>Number of Rows:</label>
        <input type="number" id="rowCount" value="10" min="1" class="form-control" style="width:150px;">
    </div>

    <!-- Fields list -->
    <div id="fieldsContainer">
        <!-- Fields will be inserted dynamically -->
    </div>

    <button id="addField" class="btn btn-primary my-3">Add Field</button>
    <button id="generateBtn" class="btn btn-success my-3">Generate Data</button>

    <!-- Preview -->
    <h4>Preview</h4>
    <table id="previewTable" class="display" style="width:100%">
        <thead><tr></tr></thead>
        <tbody></tbody>
    </table>

    <div class="mt-3">
        <button id="downloadCSV" class="btn btn-outline-primary">Download CSV</button>
        <button id="downloadJSON" class="btn btn-outline-secondary">Download JSON</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
let fieldId = 0;
let defaultFields = [
    {name: "id", type: "id"},
    {name: "name", type: "full_name"},
    {name: "gender", type: "gender"}
];

function createFieldRow(fieldData = {name:"", type:"text"}) {
    fieldId++;
    let row = $(`
        <div class="row g-2 align-items-center mb-2 field-row" data-id="${fieldId}">
            <div class="col-md-4">
                <input type="text" class="form-control field-name" placeholder="Field Name" value="${fieldData.name}">
            </div>
            <div class="col-md-4">
                <select class="form-control field-type">
                    <option value="id">ID</option>
                    <option value="first_name">First Name</option>
                    <option value="last_name">Last Name</option>
                    <option value="full_name">Full Name</option>
                    <option value="gender">Gender</option>
                    <option value="ipaddress">IP Address</option>
                    <option value="number">Number</option>
                    <option value="text">Text</option>
                </select>
            </div>
            <div class="col-md-4 minmax">
                <input type="number" class="form-control min-val" placeholder="Min">
                <input type="number" class="form-control max-val" placeholder="Max">
            </div>
        </div>
    `);
    row.find(".field-type").val(fieldData.type);
    row.find(".field-type").on("change", function(){
        if ($(this).val() === "number") {
            $(this).closest(".field-row").find(".minmax").show();
        } else {
            $(this).closest(".field-row").find(".minmax").hide();
        }
    }).trigger("change");
    $("#fieldsContainer").append(row);
}

// Add default fields
defaultFields.forEach(f => createFieldRow(f));

// Add new field
$("#addField").click(() => createFieldRow());

// Drag-and-drop sorting
new Sortable(document.getElementById('fieldsContainer'), {animation:150});

// Generate random IP
function randomIP() {
    return `${rand(1,255)}.${rand(0,255)}.${rand(0,255)}.${rand(1,254)}`;
}
function rand(min,max) {
    return Math.floor(Math.random()*(max-min+1))+min;
}

// Generate data
$("#generateBtn").click(function(){
    let rows = parseInt($("#rowCount").val()) || 10;
    let fields = [];
    $(".field-row").each(function(){
        fields.push({
            name: $(this).find(".field-name").val(),
            type: $(this).find(".field-type").val(),
            min: parseInt($(this).find(".min-val").val()) || 1,
            max: parseInt($(this).find(".max-val").val()) || 100
        });
    });

    // Fetch API data
    $.getJSON(`https://dummyjson.com/users?limit=${rows}`, function(apiData){
        let users = apiData.users;
        let data = [];
        for(let i=0; i<rows; i++){
            let row = {};
            fields.forEach(f => {
                let u = users[i % users.length];
                switch(f.type) {
                    case "id": row[f.name] = i+1; break;
                    case "first_name": row[f.name] = u.firstName; break;
                    case "last_name": row[f.name] = u.lastName; break;
                    case "full_name": row[f.name] = `${u.firstName} ${u.lastName}`; break;
                    case "gender": row[f.name] = u.gender; break;
                    case "ipaddress": row[f.name] = randomIP(); break;
                    case "number": row[f.name] = rand(f.min, f.max); break;
                    case "text": row[f.name] = `Sample ${i+1}`; break;
                }
            });
            data.push(row);
        }
        renderTable(fields, data);
    });
});

function renderTable(fields, data){
    if ($.fn.DataTable.isDataTable('#previewTable')) {
        $('#previewTable').DataTable().destroy();
    }
    let thead = $("#previewTable thead tr");
    thead.empty();
    fields.forEach(f => thead.append(`<th>${f.name}</th>`));
    let tbody = $("#previewTable tbody");
    tbody.empty();
    data.forEach(row => {
        let tr = $("<tr>");
        fields.forEach(f => tr.append(`<td>${row[f.name]}</td>`));
        tbody.append(tr);
    });
    $('#previewTable').DataTable({paging:false, searching:false, info:false});
    window.generatedData = data;
}

// Download CSV
$("#downloadCSV").click(function(){
    let csv = "";
    let keys = Object.keys(window.generatedData[0]);
    csv += keys.join(",") + "\n";
    window.generatedData.forEach(row => {
        csv += keys.map(k => row[k]).join(",") + "\n";
    });
    let blob = new Blob([csv], {type: "text/csv"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "data.csv";
    link.click();
});

// Download JSON
$("#downloadJSON").click(function(){
    let blob = new Blob([JSON.stringify(window.generatedData, null, 2)], {type: "application/json"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "data.json";
    link.click();
});
</script>
</body>
</html>
fake
