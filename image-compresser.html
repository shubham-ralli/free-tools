<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Compressor Tool</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f8f9fa;
      padding-top: 40px;
    }
    .tool-container {
      max-width: 1100px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }
    .preview-img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-bottom: .5rem;
      border-radius: .25rem;
    }
    .info {
      font-size: .9rem;
      color: #555;
    }
  </style>
</head>
<body>

<div class="tool-container">
  <h1 class="mb-4 text-center">üóúÔ∏è Image Compressor</h1>
  <div class="row">
    <!-- Left: upload controls -->
    <div class="col-lg-4 mb-4">
      <div class="mb-3">
        <label for="imageInput" class="form-label">Select Image(s)</label>
        <input type="file" class="form-control" id="imageInput" accept="image/*" multiple>
      </div>
      <div class="mb-3">
        <label for="qualityRange" class="form-label">Compression Quality: <span id="qualityVal">0.8</span></label>
        <input type="range" class="form-range" id="qualityRange" min="0.1" max="1" step="0.1" value="0.8">
      </div>
      <button id="compressBtn" class="btn btn-primary w-100 mb-2">Compress</button>
      <button id="downloadZipBtn" class="btn btn-success w-100" disabled>Download All as ZIP</button>
    </div>

    <!-- Right: previews -->
    <div class="col-lg-8">
      <div id="previewContainer" class="row gy-4">
        <!-- dynamically injected previews will go here -->
      </div>
    </div>
  </div>
</div>

<!-- Dependencies -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/compressorjs@1.1.1/dist/compressor.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.0/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
$(function() {
  const $input = $('#imageInput');
  const $quality = $('#qualityRange');
  const $qualityVal = $('#qualityVal');
  const $compressBtn = $('#compressBtn');
  const $downloadZipBtn = $('#downloadZipBtn');
  const $preview = $('#previewContainer');
  
  let compressedBlobs = []; // store { name, blob }

  // update quality label
  $quality.on('input', () => {
    $qualityVal.text($quality.val());
  });

  // handle compress click
  $compressBtn.on('click', () => {
    const files = $input[0].files;
    if (!files.length) {
      alert('Please select at least one image.');
      return;
    }
    compressedBlobs = [];
    $preview.empty();
    $downloadZipBtn.prop('disabled', true);

    Array.from(files).forEach((file, idx) => {
      const origSizeKB = (file.size / 1024).toFixed(2);
      new Compressor(file, {
        quality: parseFloat($quality.val()),
        success(result) {
          const compSizeKB = (result.size / 1024).toFixed(2);
          const url = URL.createObjectURL(result);

          // Build card
          const $col = $(`
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body d-flex flex-column">
                  <img src="${url}" class="preview-img" alt="Preview">
                  <p class="info">Original: ${origSizeKB} KB<br>Compressed: ${compSizeKB} KB</p>
                  <a href="${url}" download="compressed_${file.name}" class="btn btn-outline-primary mt-auto">Download</a>
                </div>
              </div>
            </div>
          `);

          $preview.append($col);
          compressedBlobs.push({ name: `compressed_${file.name}`, blob: result });

          // enable ZIP button when all done
          if (compressedBlobs.length === files.length) {
            $downloadZipBtn.prop('disabled', false);
          }
        },
        error(err) {
          console.error('Compression error:', err.message);
        }
      });
    });
  });

  // handle bulk ZIP download
  $downloadZipBtn.on('click', () => {
    if (!compressedBlobs.length) return;
    const zip = new JSZip();
    compressedBlobs.forEach(item => {
      zip.file(item.name, item.blob);
    });
    zip.generateAsync({ type: 'blob' })
      .then(content => {
        saveAs(content, 'images_compressed.zip');
      })
      .catch(err => console.error('ZIP error:', err));
  });
});
</script>

</body>
</html>
