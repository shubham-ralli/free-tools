<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom Data Generator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
    body { background-color: #f7f9fc; }
    .card { border-radius: 12px; }
    .field-row {
        cursor: grab;
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 8px;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .field-row input, .field-row select {
        max-width: 150px;
    }
    #fieldsBody { margin-top: 10px; }
    .btn-icon { display: inline-flex; align-items: center; gap: 6px; }
    .float_card{
            position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
    background: #FFF;
    box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .075) !important;
    }
</style>
</head>
<body class="p-4">

<div class="container">
    <h2 class="mb-4"><i class="fa-solid fa-database"></i> Data Generator</h2>


    

    <!-- Fields -->
    <div class="card p-3 mb-4 shadow-sm">
        <h5 class="mb-3"><i class="fa-solid fa-list"></i> Fields</h5>
        <div id="fieldsBody"></div>
        <button id="addField" class="btn btn-primary btn-icon mt-2">
            <i class="fa-solid fa-plus"></i> Add another field
        </button>
    </div>




    <div class="float_card p-3">
        <div class="container">
        <div class="row g-3 align-items-end">

            <div class="col-md-3">
                <div class="d-flex gap-2">
                 <button id="generateBtn" class="btn btn-success btn-icon">
            <i class="fa-solid fa-play"></i> Generate Data
        </button>
        <button id="downloadBtn" class="btn btn-info btn-icon" style="display:none;">
            <i class="fa-solid fa-download"></i> Download
        </button>
    </div>
    </div>
            <div class="col-md-2">
                <label class="form-label">Number of Rows</label>
                <input type="number" id="rowCount" class="form-control" value="10" min="1">
            </div>
            <div class="col-md-3">
                <label class="form-label">Download Format</label>
                <select id="downloadFormat" class="form-select">
                    <option value="csv">CSV</option>
                    <option value="json">JSON</option>
                    <option value="sql">SQL</option>
                    <option value="excel">Excel</option>
                </select>
            </div>
            <div class="col-md-3" id="jsonOptions" style="display:none;">
                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="jsonArray" checked>
                    <label class="form-check-label" for="jsonArray">Array format</label>
                </div>
            </div>
            <div class="col-md-4" id="sqlOptions" style="display:none;">
                <label class="form-label">Table Name</label>
                <input type="text" id="sqlTableName" class="form-control mb-2" value="my_table">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="includeCreateTable" checked>
                    <label class="form-check-label" for="includeCreateTable">Include CREATE TABLE</label>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Actions -->
<!--     <div class="d-flex gap-2 mb-4">
        <button id="generateBtn" class="btn btn-success btn-icon">
            <i class="fa-solid fa-play"></i> Generate Data
        </button>
        <button id="downloadBtn" class="btn btn-info btn-icon" style="display:none;">
            <i class="fa-solid fa-download"></i> Download
        </button>
    </div> -->

    <!-- Preview -->
    <div class="card p-3 shadow-sm">
        <h5 class="mb-3"><i class="fa-solid fa-table"></i> Preview</h5>
        <table id="previewTable" class="display table table-striped table-hover" style="width:100%">
            <thead></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
const fieldTypes = [
    "id","firstName","lastName","fullName","maidenName","email","phone","age",
    "birthDate","gender","date","ipAddress","boolean","address","city","state","stateCode",
    "postalCode","country","companyName","companyAddress","companyPhone","number"
];
let userData = [];

// Fetch dummy data
fetch("https://dummyjson.com/users?limit=100")
    .then(res => res.json())
    .then(data => { userData = data.users; });

// Create default rows
function createFieldRow(name, type, readOnly=false) {
    let row = document.createElement("div");
    row.className = "field-row";
    row.innerHTML = `
        <input type="text" class="form-control" value="${name}" ${readOnly ? "readonly" : ""}>
        <select class="form-select typeSelect"></select>
        <input type="number" class="form-control minVal" placeholder="Min" style="display:none;">
        <input type="number" class="form-control maxVal" placeholder="Max" style="display:none;">
        <input type="date" class="form-control minDate" style="display:none;">
        <input type="date" class="form-control maxDate" style="display:none;">
        <input type="text" class="form-control defaultVal" placeholder="Default Value">
        ${readOnly ? "" : `<button class="btn btn-danger btn-sm removeField"><i class="fa-solid fa-trash"></i></button>`}
    `;
    populateTypeSelect(row.querySelector(".typeSelect"), type);
    return row;
}

function populateTypeSelect(select, selected) {
    fieldTypes.forEach(ft => {
        let opt = document.createElement("option");
        opt.value = ft;
        opt.textContent = ft;
        if (ft === selected) opt.selected = true;
        select.appendChild(opt);
    });
}

$("#fieldsBody").append(createFieldRow("id", "id", true));
$("#fieldsBody").append(createFieldRow("name", "fullName"));
$("#fieldsBody").append(createFieldRow("gender", "gender"));

// Add field
$("#addField").on("click", () => {
    $("#fieldsBody").append(createFieldRow("", ""));
});

// Remove field
$(document).on("click", ".removeField", function(){
    $(this).parent().remove();
});

// Show Min/Max for number and date type
$(document).on("change", ".typeSelect", function(){
    let row = $(this).parent();
    row.find(".minVal, .maxVal, .minDate, .maxDate").hide();
    if ($(this).val() === "number") {
        row.find(".minVal, .maxVal").show();
    } else if ($(this).val() === "date") {
        row.find(".minDate, .maxDate").show();
    }
});

// Drag & Drop
new Sortable(document.getElementById("fieldsBody"), { animation: 150 });

// Format-specific UI
$("#downloadFormat").on("change", function(){
    $("#jsonOptions, #sqlOptions").hide();
    if (this.value === "json") $("#jsonOptions").show();
    if (this.value === "sql") $("#sqlOptions").show();
});

let generatedData = [];
let generatedHeaders = [];

$("#generateBtn").on("click", function(){
    let rows = parseInt($("#rowCount").val());
    let fields = [];
    $("#fieldsBody .field-row").each(function(){
        let inputs = $(this).find("input, select");
        let name = inputs.eq(0).val();
        let type = inputs.eq(1).val();
        let min = inputs.eq(2).val();
        let max = inputs.eq(3).val();
        let minDate = inputs.eq(4).val();
        let maxDate = inputs.eq(5).val();
        let def = inputs.eq(6).val();
        fields.push({name, type, min, max, minDate, maxDate, def});
    });

    let output = [];
    for (let i=0; i<rows; i++) {
        let row = {};
        fields.forEach(f => row[f.name] = generateFieldData(f, i));
        output.push(row);
    }
    generatedData = output;
    generatedHeaders = fields.map(f=>f.name);

    if ($.fn.DataTable.isDataTable('#previewTable')) {
        $('#previewTable').DataTable().destroy();
    }
    $("#previewTable thead").html("<tr>"+generatedHeaders.map(h=>`<th>${h}</th>`).join("")+"</tr>");
    $("#previewTable tbody").html(output.map(r => "<tr>"+generatedHeaders.map(h=>`<td>${r[h]}</td>`).join("")+"</tr>").join(""));
    $('#previewTable').DataTable({paging:true, searching:true, info:true});
    $("#downloadBtn").show();
});

function generateFieldData(f, index) {
    if (f.def) return f.def;
    let user = userData[index % userData.length] || {};
    switch(f.type) {
        case "id": return index+1;
        case "firstName": return user.firstName || "";
        case "lastName": return user.lastName || "";
        case "fullName": return `${user.firstName || ""} ${user.lastName || ""}`;
        case "maidenName": return user.maidenName || "";
        case "email": return user.email || "";
        case "phone": return user.phone || "";
        case "age": return user.age || "";
        case "birthDate": return user.birthDate || "";
        case "gender": return user.gender || "";
        case "address": return user.address?.address || "";
        case "ipAddress": return `${rand(1,255)}.${rand(0,255)}.${rand(0,255)}.${rand(0,255)}`;
        case "boolean": return Math.random() < 0.5 ? "true" : "false";
        case "city": return user.address?.city || "";
        case "state": return user.address?.state || "";
        case "stateCode": return user.address?.stateCode || "";
        case "postalCode": return user.address?.postalCode || "";
        case "country": return user.address?.country || "";
        case "companyName": return user.company?.name || "";
        case "companyAddress": return user.company?.address?.address || "";
        case "companyPhone": return user.company?.phone || "";
        case "number":
            let min = parseInt(f.min) || 0;
            let max = parseInt(f.max) || 1000;
            return rand(min, max);
        case "date":
            let minDate = f.minDate ? new Date(f.minDate) : new Date('2000-01-01');
            let maxDate = f.maxDate ? new Date(f.maxDate) : new Date();
            return randomDate(minDate, maxDate).toISOString().split('T')[0];
        default: return "";
    }
}
function rand(min, max) { return Math.floor(Math.random()*(max-min+1))+min; }
function randomDate(start, end) {
    return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
}

// Download
$("#downloadBtn").on("click", function(){
    let format = $("#downloadFormat").val();
    if (format === "csv") {
        let csv = generatedHeaders.join(",") + "\n";
        generatedData.forEach(r => { csv += generatedHeaders.map(h => `"${r[h]}"`).join(",") + "\n"; });
        downloadFile(csv, "data.csv", "text/csv");
    } else if (format === "json") {
        if ($("#jsonArray").is(":checked")) {
            downloadFile(JSON.stringify(generatedData, null, 2), "data.json", "application/json");
        } else {
            let text = generatedData.map(o => JSON.stringify(o)).join("\r\n");
            downloadFile(text, "data.json", "application/json");
        }
    } else if (format === "sql") {
        let table = $("#sqlTableName").val() || "my_table";
        let sql = "";
        if ($("#includeCreateTable").is(":checked")) {
            sql += `CREATE TABLE ${table} (${generatedHeaders.map(h => `\`${h}\` TEXT`).join(", ")});\n`;
        }
        generatedData.forEach(r => {
            sql += `INSERT INTO ${table} (${generatedHeaders.join(", ")}) VALUES (${generatedHeaders.map(h => `'${r[h]}'`).join(", ")});\n`;
        });
        downloadFile(sql, "data.sql", "application/sql");
    } else if (format === "excel") {
        let ws = XLSX.utils.json_to_sheet(generatedData);
        let wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, "data.xlsx");
    }
});

function downloadFile(content, fileName, type) {
    let blob = new Blob([content], { type });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
</script>
</body>
</html>
